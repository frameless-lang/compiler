data Action = ChangeText(String) | CreateTodo | ToggleDone(Integer);


style = {
	.row = {
		color = Blue

		&.done = {
			color = Grey
		}
	}
}


state = / -> {
	init = { currentText = "", todos = [] }
	reducer = /state@{ currentText }, ChangeText(text) ->
		{ currentText = text | state}
	reducer = /{ todos, currentText }, CreateTodo ->
		{ currentText = "",  todos = [{value = currentText, isDone = False }] ++ todos }
	reducer = /state@{ todos }, ToggleDone(index) ->
		let todos' = [{ isDone = if index == index' then False else todo.isDone == False | todo } | \[ todo@{ isDone }, index' ] <- zipWithIndex(todos)];
		{ todos = todos' | state }
}

main = /props ->
	\[{todos, textValue}, todosDispatch] <- model(state());

	$input{
		value = Text(textValue)
		oninput = /Text(textValue) ->
			todosDispatch(ChangeText(textValue))
	}
	$button{
		type = Submit
		onclick = /_ -> todosDispatch(CreateTodo)
	}
	$ul
		if todos.length == 0 then
			"You don't have any todos left"
		else
			each \[{value, isDone}, index] <- zipWithIndex(todos)
				$li{
					class = "row"
					class?done = isDone
					onclick = /_ -> todosDispatch(ToggleDone(index))
				}
					"${value}"
