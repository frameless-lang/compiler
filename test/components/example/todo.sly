data Action = ChangeText[String] | CreateTodo | ToggleDone[Integer];

store = {
	init = { currentText = "", todos = [] }

	reducer = \state@{ currentText }, ChangeText[text] ->
		{ currentText = text | state}
	reducer = \{ todos, currentText }, CreateTodo ->
		{ currentText = "",  todos = [{value = currentText, isDone = False }] ++ todos }
	reducer = \state@{ todos }, ToggleDone[index]->
		let todos' = [
			{
				isDone = if index == index' then
					todo.isDone == False
				else
					isDone
			| todo }
		| let [ todo@{ isDone }, index' ] <- zip(todos, 0..);];

		{ todos = todos' | state }
}

main = \props ->
	let [{todos, textValue}, todosDispatch] <- model(store);

	$link{
		href="./todo.css"
		rel="stylesheet"
	}
	$form{
		onsubmit = \_ -> todosDispatch(CreateTodo)
	}
		$input{
			value = Text[textValue]
			oninput = \Text[textValue] ->
				todosDispatch(ChangeText[textValue])
		}
		$button{
			type = Submit
		}

	$ul
		if todos.length == 0 then
			"You don't have any todos left"
		else
			let [{value, isDone}, index] <- zip(todos, 0..);
			$li{
				class = "row"
				class?done = isDone
				onclick = \_ -> todosDispatch(ToggleDone[index])
			}
				"${value}"
