data Action = ChangeText[String] | CreateTodo | ToggleDone[Integer];

state = \ -> {
	init = { currentText = "", todos = [] }

	reducer = \state@{ currentText }, ChangeText[text] ->
		{ currentText = text | state}
	reducer = \{ todos, currentText }, CreateTodo ->
		{ currentText = "",  todos = [{value = currentText, isDone = False }] ++ todos }
	reducer = \state@{ todos }, ToggleDone[index]->
		let todos' = [
			{
				isDone = if index == index' then
					False
				else
					todo.isDone == False
			| todo }
		| let [ todo@{ isDone }, index' ] <- zip(todos, 0..);];

		{ todos = todos' | state }
}

main = \props ->
	let [{todos, textValue}, todosDispatch] <- model(state());

	$link{
		href="./todo.css"
		rel="stylesheet"
	}
	$input{
		value = Text[textValue]
		oninput = \Text[textValue] ->
			todosDispatch(ChangeText[textValue])
	}
	$button{
		type = Submit
		onclick = \_ -> todosDispatch(CreateTodo)
	}
	$ul
		if todos.length == 0 then
			"You don't have any todos left"
		else
			let [{value, isDone}, index] <- zip(todos, 0..);
			$li{
				class = "row"
				class?done = isDone
				onclick = \_ -> todosDispatch(ToggleDone[index])
			}
				"${value}"
